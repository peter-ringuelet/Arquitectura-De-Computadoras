HAND_DATOS EQU 40H
HAND_ESTADO EQU 41H

ORG 1000H
CADENA DB "AaBAdsdsZD"
FIN DB ?

ORG 3000H
INI_IMP: IN AL, HAND_ESTADO
AND AL, 01111111B
OUT HAND_ESTADO, AL
RET

SELECCIONADO: PUSH AX
PUSH BX
PUSH CX
MOV DL, 0
CMP BYTE PTR [BX], 41H
JS TERMINAR
MOV AL, 5AH
CMP AL, BYTE PTR [BX]
JS TERMINAR
MOV DL, 1
TERMINAR: POP CX
POP BX
POP AX
RET

ORG 2000H
PUSH AX
CALL INI_IMP
POP AX
MOV BX, OFFSET CADENA
MOV CL, OFFSET FIN - OFFSET CADENA
LOOP: CALL SELECCIONADO
CMP DL, 1
JNZ SIGUIENTE
POLL: IN AL, HAND_ESTADO
AND AL, 1
JNZ POLL
MOV AL, [BX]
OUT HAND_DATOS, AL
SIGUIENTE: INC BX
DEC CL
JNZ LOOP
INT 0
END